---
layout: page
title: SaaS组件与应用的集成
permalink: /SaaSinApp/
---

# 界面集成 #
一般在应用程序网页上放置一个div标签（标签的id可以按约定），在标签内放置一段js代码。在代码中放置一些参数控制来控制SaaS组件的行为。更复杂的参数，可以进入SaaS服务的管理控制台来维护。  
由于AJAX调用无法跨域，div下可能要嵌入iframe（disqus这样实现）。  
对于流行的一些展现层框架可以提供个性化集成方案，如社会化评论服务往往提供wordpress、facebook等的个性化集成方案。  

# 数据安全 #
需要从租户和用户两个角度考虑数据安全。   租户之间的数据要建立隔离，用户之间的数据也要建立隔离。直觉上要认证租户身份，但实际上不需要。原因是不同租户的域名不一样，即引用SaaS组件的网页的域名不会重复，而且难以仿冒。但在企业内网或开发环境中，由于域名解析不像互联网那么完备，需要特殊考虑。  
用户靠SaaS组件提供身份认证和会话机制来确保数据安全。

# 单点登录 #
用户登录应用后，应用要生成一个令牌发给SaaS组件，以便帮助SaaS组件为用户建立会话。下面以“评论”SaaS组件为例说明令牌格式：  
令牌分三部分：消息、签名、时间戳，即：
  ```
  this.page.remote_auth_s3 = '<message> <hmac> <timestamp>';
  ```
  message的构成：userid、username、email以及两个可选参数avatar（用户头像url）、url（用户个人网站url）。userid要保证在SaaS组件内内的唯一性，如加上租户id当前缀。
  签名算法：``` HMAC->SHA1(secret_key, message + ' ' + timestamp) ```

（以上方案参照了disqus的单点登录方式）

当SaaS组件收到令牌后，可能新建用户，可能更新用户信息（如头像），最后会建立用户会话。

SaaS组件应提供用户登出API。

# 扩展性 #
可以通过一些参数配置提供扩展性，如disqus可以配置底色。

最好提供展现层开源及托管机制，如stormpath的id site。考虑展现层尽量用静态页面+js实现，因为文件的托管比程序容易实现和运维难度低。可以在github上开源，提供从github项目上同步文件到SaaS组件前端的能力（其实是一种CDN能力）。

CDN能力需要基础设施的支持。


